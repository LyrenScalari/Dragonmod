package dragonmod.actions;

import com.megacrit.cardcrawl.actions.AbstractGameAction;
import com.megacrit.cardcrawl.monsters.AbstractMonster;
import com.megacrit.cardcrawl.powers.AbstractPower;

import java.util.function.Supplier;

public class ExploitAction extends AbstractGameAction {
    Supplier<AbstractGameAction> ExploitEffect;
    AbstractPower ExploitedPower;
    AbstractMonster Target;
    int ExploitCount;
    public ExploitAction(Supplier<AbstractGameAction> exploitEffect, int exploitCount, AbstractMonster target) {
        ExploitEffect = exploitEffect;
        ExploitCount = exploitCount;
        Target = target;
    }

    public ExploitAction(Supplier<AbstractGameAction> exploitEffect, String exploitedPower, AbstractMonster target) {
        ExploitEffect = exploitEffect;
        ExploitedPower = target.getPower(exploitedPower);
    }
    @Override
    public void update() {
        if (ExploitedPower != null){
            addToTop(ExploitEffect.get());
            isDone= true;
        } else if (ExploitCount > 0){
            int debuffcounter = 0;
            for (AbstractPower p : Target.powers){
                if (p.type == AbstractPower.PowerType.DEBUFF){
                    debuffcounter++;
                }
            }
            if (debuffcounter >= ExploitCount){
                addToTop(ExploitEffect.get());
                isDone = true;
            }
        }
        isDone= true;
    }
}
